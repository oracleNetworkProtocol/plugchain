(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{452:function(s,a,t){"use strict";t.r(a);var e=t(15),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"磁盘使用优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#磁盘使用优化"}},[s._v("#")]),s._v(" 磁盘使用优化")]),s._v(" "),a("p",[s._v("自定义配置设置以降低验证器节点的磁盘要求")]),s._v(" "),a("p",[s._v("区块链数据库往往会随着时间的推移而增长，这取决于例如 在块速度和交易金额。")]),s._v(" "),a("p",[s._v("可以进行很少的配置来减少所需的磁盘使用率相当显着。 其中一些更改全面生效仅当您进行配置并从 start 开始同步时\n他们在使用中。")]),s._v(" "),a("h2",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[s._v("#")]),s._v(" 索引")]),s._v(" "),a("p",[s._v("如果您不需要从特定节点查询交易，您可以禁用索引。 在 "),a("code",[s._v("config.toml")]),s._v(" 设置")]),s._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("indexer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"null"')]),s._v("\n")])])]),a("p",[s._v("如果您在已同步的节点上执行此操作，则不会清除收集到的索引自动，您需要手动删除它。 该索引位于在名为“data/tx_index.db/”的数据库目录下。")]),s._v(" "),a("h2",{attrs:{id:"状态同步快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#状态同步快照"}},[s._v("#")]),s._v(" 状态同步快照")]),s._v(" "),a("p",[s._v("我相信这是默认情况下在 Plugchain 上禁用的。 在 "),a("code",[s._v("app.toml")]),s._v(" 设置")]),s._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("snapshot-interval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),a("p",[s._v("请注意，如果在网络上启用了状态同步并且工作正常，它将允许一个人在几分钟内同步一个新节点。 但是这个节点不会有历史。")]),s._v(" "),a("h2",{attrs:{id:"配置-修剪"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-修剪"}},[s._v("#")]),s._v(" 配置 修剪")]),s._v(" "),a("p",[s._v("默认情况下，每 500 个状态，最后 100 个状态被保留。 这从长远来看会消耗大量磁盘空间，并且可以通过以下方式进行优化\n以下自定义配置：")]),s._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pruning")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"custom"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pruning-keep-recent")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pruning-keep-every")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pruning-interval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10"')]),s._v("\n")])])]),a("p",[s._v("配置 "),a("code",[s._v('pruning-keep-recent = "0"')]),s._v(" 可能听起来很诱人，但这如果 "),a("code",[s._v("plugchaind")]),s._v(" 因任何原因被杀死，将面临数据库损坏的风险。\n因此，建议保留少数最新状态。")]),s._v(" "),a("h2",{attrs:{id:"日志记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志记录"}},[s._v("#")]),s._v(" 日志记录")]),s._v(" "),a("p",[s._v("默认情况下，日志记录级别设置为"),a("code",[s._v("info")]),s._v("，这会产生很多日志。 此日志级别在启动时可能会很好，以查看\n节点开始正确同步。 但是，在您看到同步后\n顺利进行，您可以将日志级别降低到"),a("code",[s._v("warn")]),s._v("或者"),a("code",[s._v("error")]),s._v("。 在\n"),a("code",[s._v("config.toml")]),s._v(" 设置如下")]),s._v(" "),a("div",{staticClass:"language-toml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("log_level")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"warn"')]),s._v("\n")])])]),a("p",[s._v("还要确保您的日志轮换配置正确。")]),s._v(" "),a("h2",{attrs:{id:"结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结果"}},[s._v("#")]),s._v(" 结果")]),s._v(" "),a("p",[s._v("以下是 Plugchai 测试网两周后的磁盘使用情况。 默认\n配置导致磁盘使用量为 90GB。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".3G    ./state.db\n70G     ./application.db\n20K     ./snapshots/metadata.db\n24K     ./snapshots\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".0G    ./blockstore.db\n20K     ./evidence.db\n1018M   ./cs.wal\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".7G    ./tx_index.db\n90G     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),a("p",[s._v("此优化配置已将磁盘使用量减少到 17 GB。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("17G     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1G    ./cs.wal\n946M    ./application.db\n20K     ./evidence.db\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".1G    ./blockstore.db\n24K     ./snapshots\n20K     ./snapshots/metadata.db\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".3G    ./state.db\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);